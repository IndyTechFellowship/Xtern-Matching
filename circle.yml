general:
  branches:
    only:
      - master
      - enviroments-integration
      
machine:
  environment:
    # Add app engine sdk to pythonpath for local unit tests.
    PYTHONPATH: $(PYTHONPATH):$(HOME)/google_appengine
    # Add app engine sdk to path
    PATH: ${HOME}/go_appengine/:${PATH}
    # Project-ID
    GCLOUD_PROJECT: "xtern-matching"

dependencies:
  pre:
    # Download App Engine SDK
    - curl -o $HOME/go_appengine_sdk_linux_amd64-1.9.40.zip https://storage.googleapis.com/appengine-sdks/featured/go_appengine_sdk_linux_amd64-1.9.40.zip
    - unzip -q -d $HOME $HOME/go_appengine_sdk_linux_amd64-1.9.40.zip
    - mkdir $HOME/go_appengine/gopath/src
    - ln -s $HOME/Xtern-Matching $HOME/go_appengine/gopath/src
  override:
    # './...' is a relative pattern which means all subdirectories
    #- cd ../go_appengine/gopath/src/Xtern-Matching/core
    #- ln -s $HOME/go_appengine/gopath/src/Xtern-Matching/core $HOME/
    - goapp get Xtern-Matching/core
    - npm install Xtern-Matching/core
test:
  override:
    - goapp test Xtern-Matching/tests
